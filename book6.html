<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/jpeg" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <title>عرض الكتاب</title>
  <style>
/* إعدادات عامة */
body {
    font-family: Arial, sans-serif;   /* نوع الخط Arial ولو مش موجود ياخد sans-serif */
    text-align: center;              /* محاذاة النص للوسط */
    direction: rtl;                   /* اتجاه النص من اليمين لليسار (مناسب للعربية) */
    transition: background 0.3s, color 0.3s; /* انتقال سلس بين الأوضاع */
}

.btn-container {
  display: grid;
  grid-template-columns: repeat(2, auto);
  gap: 6px;
  justify-content: center;
}

.btn-container button:nth-child(3) {
  grid-column: span 2; /* يخلي الزر الثالث ياخد عرض العمودين */
}

/* ===== الوضع العادي (فاتح) ===== */
body.light {
    background: #f7f7f7;              /* خلفية الصفحة رمادي فاتح */
    color: #222;                      /* النص داكن */
}

body.light h1 {
    color: #333;                      /* عنوان غامق */
}

body.light .details {
    color: #444;                      /* نص رمادي متوسط */
}

body.light .book-card {
    background: #fff;                 /* كارت أبيض */
    color: #000;                      /* النص أسود */
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);  /* ظل خفيف */
}

body.light iframe {
    border: 1px solid #ccc;           /* إطار رمادي فاتح */
}

/* ===== الوضع الداكن ===== */
body.dark {
    background: #121212;              /* خلفية داكنة جدًا */
    color: #f1f1f1;                   /* النصوص فاتحة */
}

body.dark h1 {
    color: #f5f5f5;                   /* العنوان فاتح */
}

body.dark .details {
    color: #ddd;                      /* النص رمادي فاتح */
}

body.dark .book-card {
    background: #1e1e1e;              /* خلفية الكارت داكنة */
    color: #fff;                      /* النص أبيض */
    box-shadow: 0 4px 14px rgba(0,0,0,0.6);  /* ظل أقوى */
}

body.dark iframe {
    border: 1px solid #555;           /* إطار رمادي غامق */
}

/* ===== الكارت ===== */
.book-card {
    width: 250px;                     /* عرض الكارت */
    margin: 20px auto;                /* توسيط الكارت */
    padding: 15px;                    /* حشوة داخلية */
    border-radius: 15px;              /* الحواف دائرية */
    transition: transform 0.3s, box-shadow 0.3s; /* تأثير سلس */
}

.book-card:hover {
    transform: translateY(-8px);      /* تحريك للأعلى عند المرور */
}

/* ===== صورة الكتاب ===== */
.book-card img {
    width: 100%;                      /* بعرض الكارت */
    height: 300px;                    /* ارتفاع الصورة */
    object-fit: cover;                /* تغطية بدون تشويه */
    border-radius: 12px;              /* حواف منحنية */
}

/* ===== الأزرار ===== */
.btn, button {
    padding: 10px 20px;               /* مساحة داخلية */
    margin: 10px;                     /* مساحة خارجية */
    font-size: 18px;                  /* حجم النص */
    cursor: pointer;                  /* مؤشر اليد */
    border: none;                     /* بدون حدود */
    border-radius: 8px;               /* حواف دائرية */
    background: #04b5b2;              /* خلفية تركواز */
    color: #fff;                      /* النص أبيض */
    text-decoration: none;            /* بدون خط سفلي */
    display: inline-block;            /* عرض كتلي */
    transition: 0.3s;                 /* انتقال سلس */
}

.btn:hover, button:hover {
    background: #cd146a;              /* لون وردي عند المرور */
}

/* ===== عارض PDF ===== */
#pdfViewer {
    display: none;                    /* مخفي افتراضيًا */
    margin-top: 20px;                 /* مسافة من الأعلى */
}

iframe {
    border-radius: 10px;              /* الحواف منحنية */
}

/* ===== تقييم الكتاب ===== */
.rating-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px; /* مسافة بين النجوم والزر */
}

.rating span {
  font-size: 30px;
  cursor: pointer;
  color: #ccc;
  transition: color 0.3s;
}

.rating span.active {
  color: gold;
}

#unrateBtn {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  background: #ff4d4d;
  color: white;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.3s;
}

#unrateBtn:hover {
  background: #e60000;
}
  </style>
</head>
<body>
  <h1>كتاب الثقافة العربية العقاد</h1>

  <div class="details">
    مؤلف : عباس العقاد <br>
    قسم : الثقافة العربية <br>
    اللغة : العربية <br>
    الصفحات : 78
  </div>

  <div class="book-card">
    <img src="img/book6.jpg" alt="book3">
  </div>

  <div id="bookStats">
    <p>👁️ المشاهدات: <span id="views">0</span></p>
    <p>⭐ التقييم: <span id="avgRating">0</span> من <span id="totalVotes">0</span> تقييم</p>
  </div>

  <div class="rating-container">
  <div class="rating">
    <span data-value="1">★</span>
    <span data-value="2">★</span>
    <span data-value="3">★</span>
    <span data-value="4">★</span>
    <span data-value="5">★</span>
  </div>
  <button id="unrateBtn" style="display:none;" onclick="unrate()">إلغاء التقييم</button>
  </div>

  <div class="btn-container">
    <button onclick="goHome()">الرجوع للصفحة الرئيسية</button>
    <a class="btn" onclick="showPDF()">اقرأ الآن</a>
    <button id="toggleMode">🌙 الوضع الداكن</button>
  </div>

  <div id="pdfViewer">
    <iframe src="file/Arab culture.pdf" width="80%" height="600px"></iframe>
    <br>
    <button onclick="goHome()">الرجوع للصفحة الرئيسية</button>
  </div>

  <script>
const book_id = "book6"; // 👈 كل كتاب ليه معرف خاص بيه

// ====== عند تحميل الصفحة ======
document.addEventListener("DOMContentLoaded", () => {
  // جلب البيانات الحالية من السيرفر
  fetch("books.php?action=get&book_id=" + book_id)
    .then(res => res.json())
    .then(data => {
      document.getElementById("views").innerText = data.views;
      document.getElementById("avgRating").innerText = data.avg.toFixed(1);
      document.getElementById("totalVotes").innerText = data.votes;
    });

  // تسجيل مشاهدة واحدة فقط لكل مستخدم
  if (!localStorage.getItem("viewed_" + book_id)) {
    fetch("books.php?action=view&book_id=" + book_id);
    localStorage.setItem("viewed_" + book_id, "true");
  }

  // لو كان المستخدم قيّم قبل كده → نرجع نلون النجوم ونظهر زر الإلغاء
  let prevRating = localStorage.getItem("rated_" + book_id);
  if (prevRating) {
    highlightStars(prevRating);
    document.getElementById("unrateBtn").style.display = "inline-block";
  }
});

// ====== التعامل مع التقييم ======
document.querySelectorAll(".rating span").forEach(star => {
  star.addEventListener("click", () => {
    let value = star.getAttribute("data-value");

    // لو المستخدم قيم قبل كده → منع التقييم مرة تانية
    if (localStorage.getItem("rated_" + book_id)) {
      alert("لقد قمت بتقييم هذا الكتاب من قبل!");
      return;
    }

    fetch("books.php?action=rate&book_id=" + book_id + "&value=" + value)
      .then(res => res.json())
      .then(data => {
        document.getElementById("views").innerText = data.views;
        document.getElementById("avgRating").innerText = data.avg.toFixed(1);
        document.getElementById("totalVotes").innerText = data.votes;
        highlightStars(value);
        localStorage.setItem("rated_" + book_id, value);
        document.getElementById("unrateBtn").style.display = "inline-block";
      });
  });
});

// ====== زر إلغاء التقييم ======
document.getElementById("unrateBtn").addEventListener("click", () => {
  let prevRating = localStorage.getItem("rated_" + book_id);
  if (!prevRating) return;

  fetch("books.php?action=unrate&book_id=" + book_id + "&value=" + prevRating)
    .then(res => res.json())
    .then(data => {
      document.getElementById("views").innerText = data.views;
      document.getElementById("avgRating").innerText = data.avg.toFixed(1);
      document.getElementById("totalVotes").innerText = data.votes;
      resetStars();
      localStorage.removeItem("rated_" + book_id);
      document.getElementById("unrateBtn").style.display = "none";
    });
});

// ====== دوال مساعدة ======
function highlightStars(value) {
  document.querySelectorAll(".rating span").forEach(star => {
    if (parseInt(star.getAttribute("data-value")) <= value) {
      star.classList.add("active");
    } else {
      star.classList.remove("active");
    }
  });
}

function resetStars() {
  document.querySelectorAll(".rating span").forEach(star => {
    star.classList.remove("active");
  });
}

function showPDF() {
  document.getElementById("pdfViewer").style.display = "block";
  window.scrollTo(0, document.getElementById("pdfViewer").offsetTop);
}

function goHome() {
  window.location.href = "index.html"; 
}
  </script>
  <script src="main.js"></script>
</body>
</html>